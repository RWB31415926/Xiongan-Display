<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>雄安</title>
    <link rel="stylesheet" href="css/wodry.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/public.css">

    <script src="https://www.jq22.com/jquery/jquery-1.10.2.js"></script>

 <script>
// ===== 地图文件映射（按 指标×周期） =====
var MAP_SRC = {
  flow: {  // 流量
    short: 'html/flow_short.html',
    mid:   'html/flow_mid.html',
    long:  'html/flow_long.html'
  },
  load: {  // 负荷
    short: 'html/vc_short.html',
    mid:   'html/vc_mid.html',
    long:  'html/vc_long.html'
  }
};

// 当前状态（默认：短期 + 流量）
window._currentPeriod = 'short';
window._currentMetric = 'flow';

// 读当前 select（兜底用）
function currentPeriod(){ return (document.getElementById('periodSelectInPanel')||{}).value || window._currentPeriod || 'short'; }
function currentMetric(){ return (document.getElementById('metricSelect')||{}).value || window._currentMetric || 'flow'; }

// 只负责切换“指标”（两个下拉里的右边那个），然后刷新地图 iframe
function applyMetric(key){
  window._currentMetric = key;                      // 记住当前指标
  var sel = document.getElementById('metricSelect');
  if (sel) sel.value = key;                         // 同步 UI
  updateMapSrc();                                   // 切地图
  setTimeout(forceResizeMap, 60);                   // 触发子页 resize，防止只显示一角
}

// 统一更新地图 iframe 的 src（由 指标×周期 决定）
function updateMapSrc(){
  var p = currentPeriod();
  var m = currentMetric();
  var url = (MAP_SRC[m] && MAP_SRC[m][p]) ? MAP_SRC[m][p] : '';

  var ifr = document.getElementById('ifr');
  if (!ifr) return;
  if (url) { ifr.src = url; ifr.style.display = 'block'; }
  else     { ifr.removeAttribute('src'); ifr.style.display = 'none'; }
}

// 强制让内嵌地图库（kepler/Mapbox/Leaflet）重算尺寸
function forceResizeMap(){
  var ifr = document.getElementById('ifr');
  try { if (ifr && ifr.contentWindow) ifr.contentWindow.dispatchEvent(new Event('resize')); } catch(e){}
}

// ===== 保留原有的滚动 & 自适应代码 =====
$(function () {
  $('.myscroll').myScroll({ speed: 60, rowHeight: 38 });
});
$(document).ready(function () {
  var whei = $(window).width();
  $("html").css({ fontSize: whei / 22 });
  $(window).resize(function () {
    var whei = $(window).width();
    $("html").css({ fontSize: whei / 22 });
  });
});
</script>

    <style>
    /* 显隐：用 !important 压过内联 display */
    .hidden  { display: none !important; }
    .visible { display: block !important; }


    </style>
</head>

<body>
 <script>
function applyPeriod(key) {
  // 记住当前周期
  window._currentPeriod = key;

  // 左列 - 基本信息
  toggleById('div_short', key==='short');
  toggleById('div_mid',   key==='mid');
  toggleById('div_long',  key==='long');

  // 左列 - 交通运行状况
  toggleById('diva_short', key==='short');
  toggleById('diva_mid',   key==='mid');
  toggleById('diva_long',  key==='long');

  // 左下 - 环形图容器
  toggleById('panel_ring_short', key==='short');
  toggleById('panel_ring_mid',   key==='mid');
  toggleById('panel_ring_long',  key==='long');

  // 中列 - 地图 iframe（由 “指标×周期” 共同决定）
  updateMapSrc();

  // 中下 - 柱线图容器
  toggleById('panel_bar_short', key==='short');
  toggleById('panel_bar_mid',   key==='mid');
  toggleById('panel_bar_long',  key==='long');

  // 右列 - 排行/中部/底部
  toggleById('rank_short_wrap', key==='short');
  toggleById('rank_mid_wrap',   key==='mid');
  toggleById('rank_long_wrap',  key==='long');

  toggleById('rightmid_short',  key==='short');
  toggleById('rightmid_mid',    key==='mid');
  toggleById('rightmid_long',   key==='long');

  toggleById('rightbot_short',  key==='short');
  toggleById('rightbot_mid',    key==='mid');
  toggleById('rightbot_long',   key==='long');

  // —— 图表只在首次进入对应周期时初始化（避免重复 init/定时器）——
  window._chart_once = window._chart_once || {};
  function once(name, fn){ if(window._chart_once[name]) return; window._chart_once[name] = true; try{ fn(); }catch(e){ console.error(e); } }

  if (key === 'short') {
    once('ring_short',    ring_short);
    once('barLine_short', barLine_short);
  } else if (key === 'mid') {
    once('ring_mid',      ring_mid);
    once('barLine_mid',   barLine_mid);
  } else if (key === 'long') {
    once('ring_long',     ring_long);
    once('barLine_long',  barLine_long);
  }

  setTimeout(forceResizeMap, 60);
}

function toggleById(id, show) {
  var el = document.getElementById(id);
  if (!el) return;
  if (show) { el.classList.remove('hidden'); el.classList.add('visible'); }
  else      { el.classList.remove('visible'); el.classList.add('hidden'); }
}
</script>

    <div class="main">
        <div class="header">
            <div class="header-left fl" id="time"></div>

            <div class="header-center fl">
                <div class="header-title">雄安新区交通推演平台</div>
                <div class="header-img"></div>
            </div>

            <div class="header-right fl"></div>
            <div class="header-bottom fl"></div>
        </div>

        <div class="center">
            <!-- ===== 左列 ===== -->
            <div class="center-left fl">
                <div class="left-top rightTop border">
                    <div class="title">基本信息</div>

                    <!-- 短期（2022） -->
                    <div class="top-list" id="div_short">
                        <ul>
                            <li>道路路段总数：1481</li>
                            <li>道路总里程：229km</li>
                            <li>交叉口总个数：434</li>
                            <li>机动车OD总量：1.9万 pcu/h</li>
                            <li>平均路段交通量：466 pcu</li>
                            <li>平均路段车速：45.88 km/h</li>
                        </ul>
                    </div>

                    <!-- 中期 -->
                    <div class="top-list" id="div_mid" style="display:none;">
                        <ul>
                            <li>道路路段总数：3843</li>
                            <li>道路总里程：739km</li>
                            <li>交叉口总个数：1089</li>
                            <li>机动车OD总量：5.2万 pcu/h</li>
                            <li>平均路段交通量：565 pcu</li>
                            <li>平均路段车速：64.73 km/h</li>
                        </ul>
                    </div>

                    <!-- 长期 -->
                    <div class="top-list" id="div_long" style="display:none;">
                        <ul>
                            <li>道路路段总数：6087</li>
                            <li>道路总里程：1685km</li>
                            <li>交叉口总个数：1859</li>
                            <li>机动车OD总量：10.8万 pcu/h</li>
                            <li>平均路段交通量：893 pcu</li>
                            <li>平均路段车速：49.41 km/h</li>
                        </ul>
                    </div>
                </div>

                <!-- 交通运行状况（短/中/长期三套） -->
                <div class="left-cen rightTop border" id="diva_short">
                    <div class="title">交通运行状况（短期）</div>
                    <ul class="top-list">
                        <li class="wodryRX2">平均出行时耗  9.76分钟</li><br/>
                        <li class="wodryRX2">平均行程车速  45.88千米/小时</li><br/>
                        <li class="wodryRX2">出行拥堵延时指数  1.03</li><br/>
                        <li class="wodryRX2">道路网络干道拥堵率  0.49%</li><br/>
                        <li class="wodryRX2">路段平均饱和度  13.31%</li><br/>
                        <li class="wodryRX2">节点平均饱和度  23.96%</li><br/>
                    </ul>
                </div>

                <div class="left-cen rightTop border" id="diva_mid" style="display:none;">
                    <div class="title">交通运行状况（中期）</div>
                    <ul class="top-list">
                        <li class="wodryRX2">平均出行时耗  13.61分钟</li><br/>
                        <li class="wodryRX2">平均行程车速  35.33千米/小时</li><br/>
                        <li class="wodryRX2">出行拥堵延时指数  1.11</li><br/>
                        <li class="wodryRX2">道路网络干道拥堵率  2.26%</li><br/>
                        <li class="wodryRX2">路段平均饱和度  23.43%</li><br/>
                        <li class="wodryRX2">节点平均饱和度  42.96%</li><br/>
                    </ul>
                </div>

                <div class="left-cen rightTop border" id="diva_long" style="display:none;">
                    <div class="title">交通运行状况（长期）</div>
                    <ul class="top-list">
                        <li class="wodryRX2">平均出行时耗  20.76分钟</li><br/>
                        <li class="wodryRX2">平均行程车速  47.58 千米/小时</li><br/>
                        <li class="wodryRX2">出行拥堵延时指数  1.05</li><br/>
                        <li class="wodryRX2">道路网络干道拥堵率  1.18%</li><br/>
                        <li class="wodryRX2">路段平均饱和度  7.90%</li><br/>
                        <li class="wodryRX2">节点平均饱和度  19.90%</li><br/>
                    </ul>
                </div>

                <div class="left-bottom rightTop border">
                    <div class="title">流量情况占比</div>
                    <div class="bottom-b" style="height: 220px;">
                        <!-- 短期默认图表容器 -->
                        <div id="panel_ring_short" class="allnav visible" style="width:100%; height:100%;">
                        <div id="ring_short" style="width:100%; height:100%;"></div>
                        </div>
                        <!-- 中期 -->
                        <div id="panel_ring_mid" class="allnav hidden" style="width:100%; height:100%;">
                            <div id="ring_mid" style="width:100%; height:100%;"></div>
                        </div>
                        <!-- 长期 -->
                        <div id="panel_ring_long" class="allnav hidden" style="width:100%; height:100%;">
                            <div id="ring_long" style="width:100%; height:100%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== 中列 ===== -->
            <div class="center-cen fl">
            <div class="cen-top rightTop border">
              <select id="periodSelectInPanel" style="background-color: rgba(0,72,115,0.28)" onchange="applyPeriod(this.value)">
                <option value="short" selected>短期</option>
                <option value="mid">中期</option>
                <option value="long">长期</option>
              </select>
              <select id="metricSelect" style="background-color: rgba(0,72,115,0.28)" onchange="applyMetric(this.value)">
                <option value="flow" selected>流量</option>
                <option value="load">负荷</option>
              </select>
                <!--iframe 随周期切换 -->
                <iframe id="ifr" src="html/flow_short.html"style="height: 100%" width="100%" ></iframe>
            </div>

                    <div class="cen-bottom rightTop border">
                    <div class="title">道路运行变化情况</div>
                    <div class="bottom-b">

                    <!-- 短期默认图表容器（与原ID一致） -->
                    <!-- 短期 -->
                    <div id="panel_bar_short" style="width:100%;height:100%;">
                      <div id="barLine_short" style="width:100%;height:100%;"></div>
                    </div>
                    <!-- 中期 -->
                    <div id="panel_bar_mid" style="display:none;width:100%;height:100%;">
                      <div id="barLine_mid" style="width:100%;height:100%;"></div>
                    </div>
                    <!-- 长期 -->
                    <div id="panel_bar_long" style="display:none;width:100%;height:100%;">
                      <div id="barLine_long" style="width:100%;height:100%;"></div>
                    </div>
                    </div>
                </div>
                </div>

            <!-- ===== 右列 ===== -->
            <div class="center-right fr">
                <div class="right-top rightTop border">
                    <div class="title">分区出行效率排行</div>

                    <!-- 短期（2022）排行：保留原结构与滚动 -->
                    <div id="rank_short_wrap" class="echart wenzi visible">
                        <div class="gun">
                            <span>排名</span>
                            <span>名称</span>
                            <span>出行指数</span>
                        </div>
                        <div id="FontScroll" class="myscroll">
                            <ul>
                                <li><div class="fontInner clearfix"><span><b>1</b></span><span>容城</span><span>2.42</span></div></li>
                                <li><div class="fontInner clearfix"><span><b>2</b></span><span>容东</span><span>2.38</span></div></li>
                                <li><div class="fontInner clearfix"><span><b>3</b></span><span>容西</span><span>2.30</span></div></li>
                                <li><div class="fontInner clearfix"><span><b>4</b></span><span>安新</span><span>2.22</span></div></li>
                                <li><div class="fontInner clearfix"><span><b>5</b></span><span>雄县</span><span>2.20</span></div></li>
                                <li><div class="fontInner clearfix"><span><b>6</b></span><span>昝岗</span><span>2.19</span></div></li>
                                <li><div class="fontInner clearfix"><span><b>7</b></span><span>寨里</span><span>2.18</span></div></li>
                                <li><div class="fontInner clearfix"><span><b>8</b></span><span>起步区</span><span>2.17</span></div></li>
                            </ul>
                        </div>
                    </div>

                    <!-- 中期排行占位 -->
                    <div id="rank_mid_wrap" class="echart wenzi hidden">
                        <div class="gun">
                            <span>排名</span><span>名称</span><span>出行指数</span>
                        </div>
                        <div class="placeholder-card" style="height: 220px;">中期分区排行占位</div>
                    </div>

                    <!-- 长期排行占位 -->
                    <div id="rank_long_wrap" class="echart wenzi hidden">
                        <div class="gun">
                            <span>排名</span><span>名称</span><span>出行指数</span>
                        </div>
                        <div class="placeholder-card" style="height: 220px;">长期分区排行占位</div>
                    </div>
                </div>

                <div class="right-cen border">
                    <div class="title">路口排队情况</div>
                    <div class="right-cen-cent" style="height: 250px;">
                        <!-- 右中：短期用原三维图 iframe；中/长期为占位容器（可替换为不同 src） -->
                        <div id="rightmid_short" class="visible" style="width:100%; height:98%;">
                            <iframe src="html/day_delay.html" width="100%" height="100%" frameborder="0" scrolling="no"></iframe>
                        </div>
                        <div id="rightmid_mid" class="hidden" style="width:100%; height:100%;">
                            <iframe src="html/week_delay.html" width="100%" height="100%" frameborder="0" scrolling="no"></iframe>
                        </div>
                        <div id="rightmid_long" class="hidden" style="width:100%; height:100%;">
                            <iframe src="html/week_delay.html" width="100%" height="100%" frameborder="0" scrolling="no"></iframe>
                        </div>
                    </div>
                </div>

                <div class="right-bottom rightTop border">
                    <div class="title">公交车运行统计</div>
                    <div class="chat" style="height: 220px;">
                        <!-- 右下：短期沿用原 iframe；中/长期为占位容器（可替换为不同 src） -->
                        <div id="rightbot_short" class="visible" style="width:100%; height:100%;">
                            <iframe src="html/bus_short.html" width="100%" height="100%" frameborder="0" scrolling="no"></iframe>
                        </div>
                        <div id="rightbot_mid" class="hidden" style="width:100%; height:100%;">
                            <iframe src="html/bus_mid.html" width="100%" height="100%" frameborder="0" scrolling="no"></iframe>
                        </div>
                        <div id="rightbot_long" class="hidden" style="width:100%; height:100%;">
                            <iframe src="html/bus_long.html" width="100%" height="100%" frameborder="0" scrolling="no"></iframe>
                        </div>
                    </div>
                </div>
            </div><!-- /右列 -->
        </div><!-- /center -->
    </div><!-- /main -->

    <!-- 原有脚本依赖 -->
    <script src="js/jquery.min.js"></script>
    <script src="https://www.jq22.com/jquery/echarts-4.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>
    <script src="js/wodry.min.js"></script>
    <script src="js/fontscroll.js"></script>
    <script src="js/echarts.fillfix.js"></script>

    <script>
        // 顶部时间
        function getTime(){
            var myDate = new Date();
            var myYear = myDate.getFullYear();
            var myMonth = myDate.getMonth()+1;
            var myToday = myDate.getDate();
            var myDay = myDate.getDay();
            var myHour = myDate.getHours();
            var myMinute = myDate.getMinutes();
            var mySecond = myDate.getSeconds();
            var week = ['星期日','星期一','星期二','星期三','星期四','星期五','星期六'];
            var nowTime = myYear+'-'+fillZero(myMonth)+'-'+fillZero(myToday)+'&nbsp;&nbsp;'
                        +fillZero(myHour)+':'+fillZero(myMinute)+':'+fillZero(mySecond)
                        +'&nbsp;&nbsp;'+week[myDay]+'&nbsp;&nbsp;';
            $('#time').html(nowTime);
        }
        function fillZero(str){ return (str<10)?('0'+str):str; }
        setInterval(getTime,1000);

        // 页面加载完成后，将周期初始化为“短期”
        window.addEventListener('DOMContentLoaded', function(){
            applyPeriod('short');
        });
    </script>


</body>
</html>
